# MiniJump HTTP è·³è½¬æœåŠ¡

MiniJump æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ HTTP è·³è½¬æœåŠ¡ï¼Œæ”¯æŒåŸºäºåŸŸåå’Œè·¯å¾„çš„æ™ºèƒ½è·³è½¬é…ç½®ï¼Œå…·å¤‡é«˜æ€§èƒ½å’Œæ˜“ç®¡ç†ç‰¹æ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. è·³è½¬è§„åˆ™é…ç½®
- **åŸŸåè·³è½¬**ï¼šæ ¹æ®è¯·æ±‚åŸŸåè·³è½¬åˆ°æŒ‡å®šç›®æ ‡
- **è·¯å¾„è·³è½¬**ï¼šæ”¯æŒåŸŸå+å­è·¯å¾„çš„ç²¾ç¡®åŒ¹é…è·³è½¬
- **è·³è½¬æ–¹å¼**ï¼šæ”¯æŒ 301ã€302ã€307ã€JavaScript è·³è½¬
- **æœ‰æ•ˆæœŸæ§åˆ¶**ï¼šæ”¯æŒè®¾ç½®è·³è½¬è§„åˆ™çš„æœ‰æ•ˆæœŸ

### 2. æ•°æ®ç®¡ç†
- **å†…å­˜å­˜å‚¨**ï¼šä½¿ç”¨ sync.Map å­˜å‚¨è·³è½¬è§„åˆ™ï¼Œä¿è¯é«˜æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨
- **å®æ—¶æ›´æ–°**ï¼šè§„åˆ™ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
- **æŒä¹…åŒ–**ï¼šæ”¯æŒé…ç½®æŒä¹…åŒ–åˆ°æ–‡ä»¶

### 3. æ—¥å¿—ç³»ç»Ÿ
- **è®¿é—®æ—¥å¿—**ï¼šè®°å½• IPã€User-Agentã€è·³è½¬è¯¦æƒ…ç­‰ä¿¡æ¯
- **ç¼“å†²æœºåˆ¶**ï¼šæ¯ 1000 æ¡æˆ– 3 åˆ†é’Ÿæ‰¹é‡è½ç›˜
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘ç£ç›˜ I/O æ“ä½œ

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
go mod download
go build -o minijump main.go
```

### äº¤å‰ç¼–è¯‘

é¡¹ç›®æä¾›äº†å¤šä¸ªæ„å»ºè„šæœ¬ç”¨äºä¸åŒå¹³å°ï¼š

#### Linux x86_64ï¼ˆ64ä½ï¼‰
```bash
chmod +x build-linux-x86.sh
./build-linux-x86.sh
```

#### Linux x86ï¼ˆ32ä½ï¼‰
```bash
chmod +x build-linux-x86-32.sh
./build-linux-x86-32.sh
```

#### æ„å»ºæ‰€æœ‰å¹³å°
```bash
chmod +x build-all.sh
./build-all.sh
```

æ„å»ºåçš„æ–‡ä»¶ä¼šè¾“å‡ºåˆ° `build/` ç›®å½•ã€‚

### è¿è¡Œ

```bash
./minijump -port 8080 -config rules.json -log access.log
```

### å‘½ä»¤è¡Œå‚æ•°

- `-port`: æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ï¼š8080ï¼‰
- `-config`: é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šrules.jsonï¼‰
- `-log`: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šaccess.logï¼‰
- `-log-buffer`: æ—¥å¿—ç¼“å†²å¤§å°ï¼ˆé»˜è®¤ï¼š1000ï¼‰
- `-log-flush`: æ—¥å¿—åˆ·æ–°é—´éš”ç§’æ•°ï¼ˆé»˜è®¤ï¼š180ï¼‰

### ç³»ç»ŸæœåŠ¡å®‰è£…

MiniJump æ”¯æŒå®‰è£…ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå®ç°å¼€æœºè‡ªå¯åŠ¨å’Œåå°è¿è¡Œã€‚

#### Windows æœåŠ¡å®‰è£…

1. **ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦æˆ– PowerShell**

2. **å®‰è£…æœåŠ¡**
```powershell
# ä½¿ç”¨é»˜è®¤å‚æ•°
.\minijump.exe install

# æŒ‡å®šç«¯å£å’Œé…ç½®æ–‡ä»¶
.\minijump.exe install -port 8080 -config "C:\path\to\rules.json" -log "C:\path\to\access.log"
```

3. **å¯åŠ¨æœåŠ¡**
```powershell
sc start MiniJump
```

4. **åœæ­¢æœåŠ¡**
```powershell
sc stop MiniJump
```

5. **å¸è½½æœåŠ¡**
```powershell
.\minijump.exe uninstall
```

#### Linux æœåŠ¡å®‰è£…ï¼ˆsystemdï¼‰

1. **ä½¿ç”¨ root æƒé™è¿è¡Œ**

2. **å®‰è£…æœåŠ¡**
```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°
sudo ./minijump install

# æŒ‡å®šå‚æ•°
sudo ./minijump install -port 8080 -config /etc/minijump/rules.json -log /var/log/minijump/access.log
```

3. **å¯åŠ¨æœåŠ¡**
```bash
sudo systemctl start MiniJump
```

4. **æŸ¥çœ‹æœåŠ¡çŠ¶æ€**
```bash
sudo systemctl status MiniJump
```

5. **è®¾ç½®å¼€æœºè‡ªå¯**
```bash
# æœåŠ¡å®‰è£…æ—¶ä¼šè‡ªåŠ¨å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl enable MiniJump
```

6. **å¸è½½æœåŠ¡**
```bash
sudo ./minijump uninstall
```

#### æœåŠ¡å®‰è£…å‚æ•°

å®‰è£…æœåŠ¡æ—¶å¯ä»¥ä½¿ç”¨çš„å‚æ•°ï¼š
- `-name`: æœåŠ¡åç§°ï¼ˆé»˜è®¤ï¼šMiniJumpï¼‰
- `-port`: æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ï¼š8080ï¼‰
- `-config`: é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šrules.jsonï¼‰
- `-log`: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šaccess.logï¼‰
- `-log-buffer`: æ—¥å¿—ç¼“å†²å¤§å°ï¼ˆé»˜è®¤ï¼š1000ï¼‰
- `-log-flush`: æ—¥å¿—åˆ·æ–°é—´éš”ç§’æ•°ï¼ˆé»˜è®¤ï¼š180ï¼‰

**æ³¨æ„**ï¼š
- Windows éœ€è¦ç®¡ç†å‘˜æƒé™
- Linux éœ€è¦ root æƒé™ï¼ˆä½¿ç”¨ sudoï¼‰
- æœåŠ¡å®‰è£…åä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šçš„å‚æ•°å¯åŠ¨

## ç®¡ç†é¡µé¢

è®¿é—® `http://localhost:8080/manager558630` æ‰“å¼€ Web ç®¡ç†ç•Œé¢ã€‚

ç®¡ç†é¡µé¢åŠŸèƒ½ï¼š
- ğŸ“‹ **è§„åˆ™åˆ—è¡¨**ï¼šæŸ¥çœ‹æ‰€æœ‰è·³è½¬è§„åˆ™ï¼ŒåŒ…æ‹¬åŸŸåã€è·¯å¾„ã€ç›®æ ‡URLã€è·³è½¬ç±»å‹ç­‰
- â• **æ·»åŠ è§„åˆ™**ï¼šé€šè¿‡è¡¨å•åˆ›å»ºæ–°çš„è·³è½¬è§„åˆ™
- âœï¸ **ç¼–è¾‘è§„åˆ™**ï¼šä¿®æ”¹ç°æœ‰è§„åˆ™çš„é…ç½®
- ğŸ—‘ï¸ **åˆ é™¤è§„åˆ™**ï¼šåˆ é™¤ä¸éœ€è¦çš„è§„åˆ™
- ğŸ”„ **é‡æ–°åŠ è½½**ï¼šä»é…ç½®æ–‡ä»¶é‡æ–°åŠ è½½è§„åˆ™
- ğŸ’¾ **ä¿å­˜é…ç½®**ï¼šå°†å½“å‰è§„åˆ™ä¿å­˜åˆ°é…ç½®æ–‡ä»¶
- âš ï¸ **å†²çªæ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶æç¤ºè§„åˆ™å†²çª

### è§„åˆ™å†²çªæ£€æµ‹

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹å†²çªæƒ…å†µï¼š
- **å®Œå…¨é‡å¤**ï¼šç›¸åŒçš„åŸŸåå’Œè·¯å¾„ç»„åˆ
- **åŸŸåè¦†ç›–**ï¼šåŸŸåçº§åˆ«è§„åˆ™ä¼šè¦†ç›–è¯¥åŸŸåçš„æ‰€æœ‰è·¯å¾„è§„åˆ™
- **è·¯å¾„è¢«è¦†ç›–**ï¼šå¦‚æœå­˜åœ¨åŸŸåçº§åˆ«è§„åˆ™ï¼Œè·¯å¾„è§„åˆ™å°†æ— æ³•åŒ¹é…

å½“æ£€æµ‹åˆ°å†²çªæ—¶ï¼Œç³»ç»Ÿä¼šï¼š
- æ˜¾ç¤ºå†²çªæç¤ºä¿¡æ¯
- åˆ—å‡ºæ‰€æœ‰å†²çªçš„è§„åˆ™è¯¦æƒ…
- é˜»æ­¢ä¿å­˜å†²çªçš„è§„åˆ™

## API æ¥å£

### 1. åˆ—å‡ºæ‰€æœ‰è§„åˆ™

```bash
GET /api/rules
```

### 2. åˆ›å»ºè§„åˆ™

```bash
POST /api/rules
Content-Type: application/json

{
  "domain": "example.com",
  "path": "/old",
  "target": "https://example.com/new",
  "type": 302,
  "expires_at": "2024-12-31T23:59:59Z",
  "description": "ä¸´æ—¶è·³è½¬"
}
```

### 3. è·å–è§„åˆ™

```bash
GET /api/rules/{id}
```

### 4. æ›´æ–°è§„åˆ™

```bash
PUT /api/rules/{id}
Content-Type: application/json

{
  "domain": "example.com",
  "path": "/old",
  "target": "https://example.com/new",
  "type": 301,
  "description": "æ°¸ä¹…è·³è½¬"
}
```

### 5. åˆ é™¤è§„åˆ™

```bash
DELETE /api/rules/{id}
```

### 6. é‡æ–°åŠ è½½é…ç½®

```bash
POST /api/reload
```

### 7. ä¿å­˜é…ç½®

```bash
POST /api/save
```

## è·³è½¬ç±»å‹

- `301`: HTTP 301 æ°¸ä¹…é‡å®šå‘
- `302`: HTTP 302 ä¸´æ—¶é‡å®šå‘
- `307`: HTTP 307 ä¸´æ—¶é‡å®šå‘ï¼ˆä¿æŒè¯·æ±‚æ–¹æ³•ï¼‰
- `4`: JavaScript è·³è½¬

## é…ç½®æ–‡ä»¶æ ¼å¼

é…ç½®æ–‡ä»¶ä¸º JSON æ ¼å¼ï¼Œå­˜å‚¨åœ¨ `rules.json`ï¼ˆå¯é€šè¿‡ `-config` å‚æ•°æŒ‡å®šï¼‰ï¼š

```json
[
  {
    "id": "example_com",
    "domain": "example.com",
    "path": "",
    "target": "https://www.example.com",
    "type": 301,
    "expires_at": null,
    "created_at": "2024-01-01T00:00:00Z",
    "description": "åŸŸåè·³è½¬"
  },
  {
    "id": "example_com_old",
    "domain": "example.com",
    "path": "/old",
    "target": "https://example.com/new",
    "type": 302,
    "expires_at": "2024-12-31T23:59:59Z",
    "created_at": "2024-01-01T00:00:00Z",
    "description": "è·¯å¾„è·³è½¬"
  }
]
```

## è®¿é—®æ—¥å¿—æ ¼å¼

è®¿é—®æ—¥å¿—ä¸º JSON Lines æ ¼å¼ï¼Œæ¯æ¡è®°å½•ä¸€è¡Œï¼š

```json
{"timestamp":"2024-01-01T12:00:00Z","ip":"127.0.0.1","user_agent":"Mozilla/5.0...","method":"GET","domain":"example.com","path":"/old","target":"https://example.com/new","redirect_type":302,"status_code":302}
```

## è§„åˆ™åŒ¹é…ä¼˜å…ˆçº§

1. ç²¾ç¡®åŒ¹é…ï¼šåŸŸå + è·¯å¾„
2. åŸŸååŒ¹é…ï¼šä»…åŸŸå

## é¡¹ç›®ç»“æ„

```
mini_jump/
â”œâ”€â”€ main.go          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config/          # é…ç½®ç®¡ç†æ¨¡å—
â”‚   â””â”€â”€ config.go
â”œâ”€â”€ handler/         # HTTP è¯·æ±‚å¤„ç†
â”‚   â””â”€â”€ handler.go
â”œâ”€â”€ logger/          # æ—¥å¿—ç®¡ç†
â”‚   â””â”€â”€ logger.go
â”œâ”€â”€ api/             # RESTful API
â”‚   â””â”€â”€ api.go
â”œâ”€â”€ manager/         # ç®¡ç†é¡µé¢
â”‚   â””â”€â”€ manager.go
â”œâ”€â”€ service/         # ç³»ç»ŸæœåŠ¡ç®¡ç†
â”‚   â””â”€â”€ service.go
â”œâ”€â”€ go.mod           # Go æ¨¡å—å®šä¹‰
â””â”€â”€ README.md        # é¡¹ç›®æ–‡æ¡£
```

## å¼€å‘

```bash
# è¿è¡Œæµ‹è¯•
go run main.go

# æ„å»º
go build -o minijump main.go

# è¿è¡Œæµ‹è¯•æœåŠ¡å™¨
./minijump -port 8080
```

åœ¨çº¿æµ‹è¯•ï¼š[http://http://minijump.demo.91hu.top/manager558630](http://minijump.demo.91hu.top/manager558630)

## è®¸å¯è¯

MIT License

